## 参考
- [pBFT算法的关键设计，你可能忽视了](https://learnblockchain.cn/article/2384)
- [详解实用拜占庭协议PBFT](https://learnblockchain.cn/2019/08/29/pbft/)

## 基本概念

* View视图

>这个机制下有一个叫视图view的概念，在一个视图里，一个是主节点，其余的都叫备份节点。主节点负责将来自客户端的请求给排好序，然后按序发送给备份节点们。但是主节点可能会是拜占庭的：它可能会给不同的请求编上相同的序号，或者不去分配序号，或者让相邻的序号不连续。备份节点应当有职责来主动检查这些序号的合法性，并能通过timeout机制检测到主节点是否已经宕掉。当出现这些异常情况时，这些备份节点就会触发视图更换view change协议来选举出新的主节点。

## 设计原理

* 为何支持3f+1的容错能力

> 为何至少3f+1？
拜占庭容错算法的目的是使得所有诚实的节点最终状态一致并且是正确的。要达到这样的目的，必须满足诚实的节点数量多于恶意的节点（少数服从多数）。
在实际的开放网络环境中，不仅有恶意节点，还有由于网络拥堵或机器故障等原因，存在部分短暂失联的节点，也需要作为考虑的因素。
因此，假设恶意节点和失联节点的数量均为f，全网节点总数量为N，那么按照少数服从多数原则，剩余的诚实节点必须满足N-f-f>f，由此可得，N>3f，即N不少于3f+1。


在同一个view中会出现多个消息需要共识，每个序列号n对应一个m

不同的view的消息是独立的，需要区分

其中pre-prepare和prepare阶段最重要的任务是保证，同一个主节点发出的请求在同一个视图（view）中的顺序是一致的，prepare和commit阶段最重要的任务是保证请求在不同视图之间的顺序是一致的。

